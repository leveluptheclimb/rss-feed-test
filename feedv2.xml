from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route("/filter_keywords", methods=["POST"])
def filter_keywords():
    """Evaluate RSS title + description for relevance based on keyword list."""
    data = request.get_json(force=True)
    title = (data.get("title") or "").lower()
    description = (data.get("description") or "").lower()
    text = f"{title} {description}"

    keywords = [
        "new office","new hq","relocate","relocation","lease","leases","leasing",
        "refurbishment","expansion","expands","opens","development","scheme",
        "redevelopment","life sciences","data centre","campus","innovation","workspace",
        "office move","tenant","occupies","taking space","fit-out","acquisition",
        "investment","logistics park","industrial estate","canary wharf","british land",
        "landsec","aviva","jll","cbre","savills","knight frank","morgan sindall",
        "isg","balfour beatty","mace","skanska"
    ]

    matched = [k for k in keywords if k.lower() in text]
    is_relevant = len(matched) > 0

    return jsonify({
        "isRelevant": is_relevant,
        "matchedKeywords": matched,
        "version": "v2.2 â€“ simplified substring matcher"
    })


if __name__ == "__main__":
    import os
    port = int(os.environ.get("PORT", 10000))
    app.run(host="0.0.0.0", port=port)
